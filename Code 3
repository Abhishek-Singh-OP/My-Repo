import pytesseract
from PIL import Image
import ipywidgets as widgets
from IPython.display import display, Image as IPImage

# Ensure pytesseract can be found
pytesseract.pytesseract.tesseract_cmd = r'/usr/local/bin/tesseract'  # Update this path based on your Tesseract installation

# Function to extract text from an image using pytesseract
def extract_text_from_image(image):
    # Convert the image to grayscale
    gray_image = image.convert('L')
    # Use pytesseract to extract text
    text = pytesseract.image_to_string(gray_image)
    return text, gray_image

# Upload widget
upload = widgets.FileUpload(accept='image/*', multiple=False)

# Function to handle file upload and text extraction
def handle_upload(change):
    for filename, file_info in upload.value.items():
        print(f"Processing file: {filename}")  # Debug print
        image = Image.open(file_info['content'])
        display(IPImage(data=file_info['content']))  # Display the uploaded image

        if 'label' in filename or 'open_text' in filename:
            extracted_text, gray_image = extract_text_from_image(image)
            print(f'Text from {filename}:')
            print(extracted_text)
            display(gray_image)
            print('-' * 40)
        else:
            print('The specified image does not contain "label" or "open_text" in its filename.')
        print('Text extraction completed.')

upload.observe(handle_upload, names='value')
display(upload)
